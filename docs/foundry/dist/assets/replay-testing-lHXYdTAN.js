import{j as e}from"./index-D5UbER3f.js";import{u as n}from"./index-CZxYc6i7.js";const d={description:"Replay test failures incrementally using persisted failure data for fuzz tests, invariant tests, and unit tests."};function r(i){const s={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",p:"p",pre:"pre",span:"span",...n(),...i.components};return e.jsxs(e.Fragment,{children:[e.jsxs(s.h2,{id:"replaying-failures",children:["Replaying Failures",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#replaying-failures",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(s.p,{children:"Forge supports incrementally replaying last test run failures by persisting them on the disk."}),`
`,e.jsxs(s.h3,{id:"rerun-failures",children:["Rerun failures",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#rerun-failures",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["The ",e.jsx(s.code,{children:"--rerun"})," option can be used to omit successful tests and replay recorded failures only:"]}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"forge"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" test"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --rerun"})]})})})}),`
`,e.jsxs(s.p,{children:["The failed tests are written in ",e.jsx(s.code,{children:"~/.foundry/cache/test-failures"})," file. This file is updated each time ",e.jsx(s.code,{children:"forge test"})," is performed, so it reflects failures from the last run."]}),`
`,e.jsxs(s.h3,{id:"fuzz-tests-failures",children:["Fuzz tests failures",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#fuzz-tests-failures",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:[`Forge saves all fuzz tests counterexamples and replays them before new test campaigns are started (This is done in order to ensure there is no regression introduced).
Fuzz tests failures encountered in several runs are by default persisted in `,e.jsx(s.code,{children:"~/.foundry/cache/fuzz/failures"})," file. The file content is not replaced by subsequent test runs, but new records are added to existing entries."]}),`
`,e.jsx(s.p,{children:"The default file used to persist and rerun fuzz test failures from can be changed in foundry.toml:"}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsxs(s.code,{children:[e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"["}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"fuzz"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]"})]}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"failure_persist_file="}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"/tests/failures.txt"'})]})]})})}),`
`,e.jsx(s.p,{children:"or by using inline config"}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsx(s.span,{className:"line",children:e.jsx(s.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"/// forge-config: default.fuzz.failure-persist-file = /tests/failures.txt"})})})})}),`
`,e.jsxs(s.h3,{id:"invariant-tests-failures",children:["Invariant tests failures",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#invariant-tests-failures",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["Failures from invariant tests are saved and replayed before new test campaigns are started, similar with fuzz tests. The difference is that the failed sequences are persisted in individual files, with specific ",e.jsx(s.code,{children:"~/.foundry/cache/invariant/failures/{TEST_SUITE_NAME}/{INVARIANT_NAME}"})," default path. Content of this file is replaced only when a different counterexample is found."]}),`
`,e.jsx(s.p,{children:"The default directory to persist invariant test failures can be changed in foundry.toml:"}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsxs(s.code,{children:[e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"["}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"invariant"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]"})]}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"failure_persist_dir="}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"/tests/dir"'})]})]})})}),`
`,e.jsx(s.p,{children:"or by using inline config"}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-Solidity",children:`/// forge-config: default.invariant.failure-persist-dir = /tests/dir
`})}),`
`,e.jsxs(s.h3,{id:"remove-persisted-failures",children:["Remove persisted failures",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#remove-persisted-failures",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["To ignore saved failures and start a clean test campaign, simply remove the persisted files or run ",e.jsx(s.a,{href:"/forge/reference/forge-clean",children:e.jsx(s.code,{children:"forge clean"})})," (removes all build artifacts and cache directories)."]})]})}function l(i={}){const{wrapper:s}={...n(),...i.components};return s?e.jsx(s,{...i,children:e.jsx(r,{...i})}):r(i)}export{l as default,d as frontmatter};
