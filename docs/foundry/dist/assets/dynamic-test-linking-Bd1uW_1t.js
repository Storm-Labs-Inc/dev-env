import{j as e}from"./index-D5UbER3f.js";import{u as t}from"./index-CZxYc6i7.js";const d=void 0;function r(i){const s={a:"a",code:"code",div:"div",h2:"h2",p:"p",pre:"pre",span:"span",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...t(),...i.components};return e.jsxs(e.Fragment,{children:[e.jsxs(s.h2,{id:"dynamic-test-linking",children:["Dynamic Test Linking",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#dynamic-test-linking",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:[e.jsx(s.a,{href:"https://github.com/foundry-rs/foundry/releases/tag/v1.1.0",children:"v1.1 release"})," comes with dynamic test linking feature, built on top of ",e.jsx(s.a,{href:"https://github.com/paradigmxyz/solar",children:"Solar"}),", which eliminates redundant test compilation when changing the contract logic, Foundry skips recompiling large test suites, resulting in massive time savings."]}),`
`,e.jsx(s.p,{children:"How it works:"}),`
`,e.jsxs(s.p,{children:["On the initial build, Foundry preprocesses test contracts by extracting constructor parameters of the contracts under test and replacing direct instantiations with ",e.jsxs(s.a,{href:"/reference/cheatcodes/get-deployed-code",children:[e.jsx(s.code,{children:"deployCode"})," cheatcodes"]}),"."]}),`
`,e.jsxs(s.p,{children:[`Subsequent compilations reuse pre-built artifacts for deployed contracts instead of recompiling both the source and all associated test contracts.
Dynamic test linking capability is built on top of `,e.jsx(s.a,{href:"https://github.com/paradigmxyz/solar",children:"Solar"}),", the blazingly fast and modular Solidity compiler."]}),`
`,e.jsxs(s.p,{children:["You can enable this feature by setting the ",e.jsx(s.code,{children:"dynamic_test_linking"})," configuration option to ",e.jsx(s.code,{children:"true"})," in your ",e.jsx(s.code,{children:"foundry.toml"})," file:"]}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsxs(s.code,{children:[e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"["}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"profile"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"default"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"]"})]}),`
`,e.jsx(s.span,{className:"line",children:e.jsx(s.span,{style:{color:"#B31D28",fontStyle:"italic","--shiki-dark":"#FF938A","--shiki-dark-font-style":"italic"},children:"..."})}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"dynamic_test_linking = "}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"true"})]})]})})}),`
`,e.jsxs(s.p,{children:["OR by passing the ",e.jsx(s.code,{children:"--dynamic-test-linking"})," flag to the ",e.jsx(s.code,{children:"forge build"})," command:"]}),`
`,e.jsx(e.Fragment,{children:e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#F69D50"},children:"forge"}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:" build"}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:" --dynamic-test-linking"})]})})})}),`
`,e.jsx(s.p,{children:"We are looking into enabling this by default in the future."}),`
`,e.jsxs(s.p,{children:["Benchmarks from the ",e.jsx(s.a,{href:"https://github.com/foundry-rs/foundry/pull/10010",children:"PR"})," show greater than 10x speedup in compilation time for large projects:"]}),`
`,e.jsxs(s.table,{children:[e.jsx(s.thead,{children:e.jsxs(s.tr,{children:[e.jsx(s.th,{children:"Project"}),e.jsx(s.th,{children:"Change"}),e.jsx(s.th,{children:"Files compiled (with / without, after initial compile)"}),e.jsx(s.th,{children:"Time to compile (with / without, after initial compile)"})]})}),e.jsxs(s.tbody,{children:[e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/Uniswap/v4-core/tree/80311e34080fee64b6fc6c916e9a51a437d0e482",children:"uniswap v4-core"})}),e.jsxs(s.td,{children:["add ",e.jsx(s.code,{children:"Lock.lock();"})," at ",e.jsx(s.a,{href:"https://github.com/Uniswap/v4-core/blob/80311e34080fee64b6fc6c916e9a51a437d0e482/src/PoolManager.sol#L107",children:"PoolManager.sol#L107"})]}),e.jsx(s.td,{children:"1 / 19"}),e.jsx(s.td,{children:"2.25s / 165.13s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/sparkdotfi/spark-psm/tree/9d0bcc045e81407408368c9a4bb6e3f13db77e32",children:"spark-psm"})}),e.jsxs(s.td,{children:["change ",e.jsx(s.code,{children:"amountOut < minAmountOut"})," at ",e.jsx(s.a,{href:"https://github.com/sparkdotfi/spark-psm/blob/9d0bcc045e81407408368c9a4bb6e3f13db77e32/src/PSM3.sol#L125",children:"PSM3.sol#L125"})]}),e.jsx(s.td,{children:"3 / 28"}),e.jsx(s.td,{children:"2.14s / 16.15s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/morpho-org/morpho-blue-bundlers/tree/1fa17256abb86c4de48fd5e251ebd46aae70ca1a",children:"morpho-blue-bundlers"})}),e.jsxs(s.td,{children:["change ",e.jsx(s.code,{children:"if (assets < 0)"})," at ",e.jsx(s.a,{href:"https://github.com/morpho-org/morpho-blue-bundlers/blob/1fa17256abb86c4de48fd5e251ebd46aae70ca1a/src/MorphoBundler.sol#L106",children:"MorphoBundler.sol#L106"})]}),e.jsx(s.td,{children:"11 / 36"}),e.jsx(s.td,{children:"16.39s / 251.05s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/morpho-org/morpho-blue/commit/9e2b0755b47bbe5b09bf1be8f00e060d4eab6f1c",children:"morpho-blue"})}),e.jsxs(s.td,{children:["add ",e.jsx(s.code,{children:"require(assets != 0, ErrorsLib.ZERO_ASSETS)"})," at ",e.jsx(s.a,{href:"https://github.com/morpho-org/morpho-blue/blob/9e2b0755b47bbe5b09bf1be8f00e060d4eab6f1c/src/Morpho.sol#L424",children:"Morpho.sol#L424"})]}),e.jsx(s.td,{children:"1 / 23"}),e.jsx(s.td,{children:"1.01s / 133.73s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/sablier-labs/lockup/tree/b2f33926fcac72a1a855c6b8ccaa75166895f13c",children:"sablier lockup"})}),e.jsxs(s.td,{children:["change ",e.jsx(s.code,{children:"if (cliffTime < 0)"})," at ",e.jsx(s.a,{href:"https://github.com/sablier-labs/lockup/blob/b2f33926fcac72a1a855c6b8ccaa75166895f13c/src/SablierLockup.sol#L480",children:"SablierLockup.sol#L480"})]}),e.jsx(s.td,{children:"1 / 104"}),e.jsx(s.td,{children:"781ms / 71.29s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/Vectorized/solady/commit/724c39bdfebb593157c2dfa6797c07a25dfb564c",children:"solady"})}),e.jsxs(s.td,{children:["add additional ",e.jsx(s.code,{children:"_setOwner(newOwner)"})," at ",e.jsx(s.a,{href:"https://github.com/Vectorized/solady/blob/724c39bdfebb593157c2dfa6797c07a25dfb564c/src/auth/Ownable.sol#L182",children:"Ownable.sol#L182"})]}),e.jsx(s.td,{children:"9 / 14"}),e.jsx(s.td,{children:"6.17s / 6.34s"})]}),e.jsxs(s.tr,{children:[e.jsx(s.td,{children:e.jsx(s.a,{href:"https://github.com/euler-xyz/ethereum-vault-connector/commit/64f6d2171a57e02a0f95bcbdecf1d92e9d253d40",children:"euler evc"})}),e.jsxs(s.td,{children:["change ",e.jsx(s.code,{children:"SET_MAX_ELEMENTS"})," to ",e.jsx(s.code,{children:"11"})," at ",e.jsx(s.a,{href:"https://github.com/euler-xyz/ethereum-vault-connector/blob/64f6d2171a57e02a0f95bcbdecf1d92e9d253d40/src/Set.sol#L7",children:"Set.sol#L7"})]}),e.jsx(s.td,{children:"28 / 30"}),e.jsx(s.td,{children:"9.17s / 9.40s"})]})]})]})]})}function l(i={}){const{wrapper:s}={...t(),...i.components};return s?e.jsx(s,{...i,children:e.jsx(r,{...i})}):r(i)}export{l as default,d as frontmatter};
